# 盛思掌控板编程助手 - 用户使用手册

## 目录
1. [快速开始](#快速开始)
2. [界面介绍](#界面介绍)
3. [设备连接](#设备连接)
4. [项目管理](#项目管理)
5. [代码编辑](#代码编辑)
6. [代码上传](#代码上传)
7. [常见问题](#常见问题)
8. [技巧和建议](#技巧和建议)

## 快速开始

### 准备工作
1. **硬件准备**
   - Android手机或平板（Android 5.0以上）
   - 盛思掌控板（2.0或3.0版本）
   - USB OTG转接头
   - USB数据线

2. **软件安装**
   - 下载并安装"盛思掌控板编程助手"APK
   - 首次启动时授予必要权限

### 第一次使用
1. 打开应用，点击右下角的"+"按钮创建新项目
2. 输入项目名称，如"我的第一个项目"
3. 连接掌控板到手机（掌控板→USB线→OTG转接头→手机）
4. 在代码编辑界面点击"运行"按钮
5. 选择检测到的设备并授予权限
6. 观察掌控板上的运行效果

## 界面介绍

### 主界面
主界面包含以下几个部分：

**顶部工具栏**
- 应用标题
- 设备管理按钮（USB图标）
- 菜单按钮（三个点）

**设备连接状态卡片**
- 显示当前连接状态
- 连接/断开按钮
- 状态指示灯（红色=未连接，绿色=已连接）

**项目列表**
- 显示所有已创建的项目
- 项目名称、描述和最后修改时间
- 点击项目可直接打开编辑

**浮动操作按钮**
- 右下角的"+"按钮
- 用于创建新项目

### 代码编辑界面
代码编辑界面是应用的核心功能区域：

**顶部工具栏**
- 返回按钮
- 项目名称（带修改标记*）
- 保存按钮
- 上传按钮
- 运行按钮

**代码编辑区**
- 支持Python语法高亮
- 显示行号
- 支持代码自动补全
- 支持多点触控缩放

**底部工具栏**
- 撤销/重做按钮
- 查找按钮
- 格式化按钮

### 设备管理界面
设备管理界面用于管理USB设备连接：

**控制面板**
- 扫描设备按钮
- 测试连接按钮

**设备列表**
- 显示所有检测到的USB设备
- 设备名称、VID/PID信息
- 连接状态指示

## 设备连接

### 连接步骤
1. **物理连接**
   ```
   掌控板 ←→ USB数据线 ←→ OTG转接头 ←→ 手机
   ```

2. **软件连接**
   - 打开应用，进入"设备管理"
   - 点击"扫描设备"按钮
   - 在设备列表中选择掌控板
   - 授予USB权限
   - 等待连接成功提示

### 支持的设备
应用支持以下类型的掌控板：
- 盛思掌控板2.0（ESP32芯片）
- 盛思掌控板3.0（ESP32-S3芯片）
- 其他基于ESP32的开发板

### 支持的USB转串口芯片
- CH340/CH341系列
- CP2102/CP2104系列
- FTDI FT232系列
- 标准CDC ACM设备

### 连接故障排除
**设备未检测到**
- 检查OTG转接头是否支持数据传输
- 确认USB数据线不是仅充电线
- 尝试重新插拔连接
- 重启应用并重新扫描

**权限被拒绝**
- 在弹出的权限对话框中选择"允许"
- 如果没有弹出对话框，检查系统设置中的USB权限
- 尝试使用不同的USB端口

**连接不稳定**
- 检查连接线缆是否松动
- 避免在充电时进行数据传输
- 确保掌控板电源充足

## 项目管理

### 创建项目
1. 在主界面点击右下角的"+"按钮
2. 输入项目名称（必填）
3. 输入项目描述（可选）
4. 点击"创建"按钮

### 打开项目
- 在主界面的项目列表中点击任意项目
- 应用会自动加载项目的主文件（main.py）

### 项目文件结构
每个项目包含以下文件：
```
项目文件夹/
└── main.py          # 主程序文件
```

### 默认代码模板
新建项目会自动包含以下示例代码：
```python
# 盛思掌控板 Python 程序
from mpython import *
import time

# 显示欢迎信息
oled.fill(0)
oled.DispChar('欢迎使用', 30, 20)
oled.DispChar('掌控板!', 35, 35)
oled.show()

# 主循环
while True:
    # 检测按键A
    if button_a.value() == 0:
        rgb[0] = (255, 0, 0)  # 红色
        rgb.write()
        print("按键A被按下")
        time.sleep(0.2)
    
    # 检测按键B  
    if button_b.value() == 0:
        rgb[0] = (0, 255, 0)  # 绿色
        rgb.write()
        print("按键B被按下")
        time.sleep(0.2)
    
    # 关闭LED
    rgb[0] = (0, 0, 0)
    rgb.write()
    
    time.sleep(0.1)
```

## 代码编辑

### 编辑器功能
**语法高亮**
- 自动识别Python关键字
- 不同颜色显示字符串、注释、数字等
- 支持MicroPython特有的模块和函数

**代码补全**
- 输入时自动提示可用的函数和变量
- 支持MicroPython标准库
- 支持掌控板特有的API

**代码格式化**
- 自动调整代码缩进
- 移除多余的空行
- 统一代码风格

### 常用快捷操作
**撤销和重做**
- 撤销：点击底部工具栏的撤销按钮
- 重做：点击底部工具栏的重做按钮

**查找和替换**
- 点击底部工具栏的查找按钮
- 输入要查找的文本
- 支持大小写敏感搜索

**代码缩放**
- 使用双指手势放大或缩小代码
- 适合不同屏幕尺寸的设备

### 保存机制
**自动保存**
- 应用会在特定时机自动保存代码
- 切换到其他应用时自动保存
- 上传代码前自动保存

**手动保存**
- 点击顶部工具栏的保存按钮
- 使用菜单中的保存选项
- 保存成功后会显示确认提示

## 代码上传

### 上传流程
1. **准备阶段**
   - 确保设备已正确连接
   - 检查代码语法无误
   - 保存当前项目

2. **上传阶段**
   - 点击"运行"或"上传"按钮
   - 应用自动建立与掌控板的通信
   - 将代码发送到掌控板
   - 等待上传完成提示

3. **执行阶段**
   - 掌控板自动执行上传的代码
   - 观察掌控板的LED、屏幕等输出
   - 通过串口监视器查看打印信息

### 上传模式
**直接运行模式**
- 代码在掌控板的RAM中运行
- 断电后代码丢失
- 适合调试和测试

**固化模式**（未来版本支持）
- 代码保存到掌控板的Flash中
- 断电后代码保留
- 适合最终部署

### 上传状态指示
**上传中**
- 显示进度提示
- 禁用其他操作按钮
- 可以取消上传操作

**上传成功**
- 显示绿色成功提示
- 掌控板开始执行代码
- 可以查看运行结果

**上传失败**
- 显示红色错误提示
- 提供错误原因说明
- 建议解决方案

## 常见问题

### 连接问题
**Q: 设备列表为空，扫描不到掌控板**
A: 
- 检查USB OTG转接头是否正常工作
- 确认使用的是数据线而非充电线
- 尝试重新插拔USB连接
- 重启应用并重新扫描

**Q: 设备显示在列表中但无法连接**
A:
- 确保已授予USB权限
- 检查掌控板是否正常启动
- 尝试使用不同的USB端口
- 重启掌控板并重新连接

**Q: 连接后立即断开**
A:
- 检查USB连接是否稳固
- 确认掌控板电源充足
- 避免在充电时进行数据传输
- 检查USB线缆质量

### 代码问题
**Q: 代码上传后掌控板没有反应**
A:
- 检查代码语法是否正确
- 确认使用的是MicroPython语法
- 查看是否有运行时错误
- 尝试上传简单的测试代码

**Q: 代码编辑器显示异常**
A:
- 重启应用
- 清除应用缓存
- 检查项目文件是否损坏
- 重新创建项目

**Q: 无法保存项目**
A:
- 检查存储权限是否已授予
- 确认设备存储空间充足
- 检查项目名称是否包含特殊字符
- 尝试重新创建项目

### 性能问题
**Q: 应用运行缓慢**
A:
- 关闭其他不必要的应用
- 重启设备释放内存
- 检查设备存储空间
- 更新到最新版本

**Q: 代码编辑器卡顿**
A:
- 减少代码文件大小
- 关闭语法高亮（如果支持）
- 重启应用
- 检查设备性能

## 技巧和建议

### 编程技巧
**模块化编程**
- 将复杂功能拆分为多个函数
- 使用有意义的变量和函数名
- 添加适当的注释说明

**调试技巧**
- 使用print()函数输出调试信息
- 逐步测试代码的各个部分
- 使用简单的LED指示程序状态

**性能优化**
- 避免在循环中进行复杂计算
- 合理使用延时函数
- 及时释放不需要的资源

### 使用建议
**项目管理**
- 使用描述性的项目名称
- 定期备份重要项目
- 为不同功能创建不同项目

**设备维护**
- 定期清洁USB接口
- 避免在潮湿环境中使用
- 妥善保管连接线缆

**学习资源**
- 查阅MicroPython官方文档
- 参考掌控板示例代码
- 加入相关技术社区

### 最佳实践
**代码风格**
```python
# 好的代码风格
def blink_led(color, duration):
    """LED闪烁函数"""
    rgb[0] = color
    rgb.write()
    time.sleep(duration)
    rgb[0] = (0, 0, 0)
    rgb.write()

# 避免的代码风格
def f(c,d):
    rgb[0]=c;rgb.write();time.sleep(d);rgb[0]=(0,0,0);rgb.write()
```

**错误处理**
```python
try:
    # 可能出错的代码
    sensor_value = light.read()
    oled.DispChar(str(sensor_value), 0, 0)
except Exception as e:
    # 错误处理
    oled.DispChar("Error: " + str(e), 0, 0)
    oled.show()
```

**资源管理**
```python
# 程序开始时初始化
oled.fill(0)
rgb.fill((0, 0, 0))
rgb.write()

# 程序结束时清理
try:
    # 主程序逻辑
    pass
finally:
    # 清理资源
    oled.fill(0)
    oled.show()
    rgb.fill((0, 0, 0))
    rgb.write()
```

## 附录

### 掌控板API参考
**显示屏控制**
```python
oled.fill(0)                    # 清屏
oled.DispChar('文字', x, y)      # 显示文字
oled.show()                     # 刷新显示
```

**LED控制**
```python
rgb[0] = (255, 0, 0)           # 设置红色
rgb.write()                    # 更新LED
```

**按键检测**
```python
if button_a.value() == 0:      # 按键A被按下
    pass
if button_b.value() == 0:      # 按键B被按下
    pass
```

**传感器读取**
```python
light_value = light.read()      # 读取光线传感器
sound_value = sound.read()      # 读取声音传感器
```

### 错误代码说明
- **USB_ERROR_001**: USB权限被拒绝
- **USB_ERROR_002**: 设备连接失败
- **USB_ERROR_003**: 数据传输错误
- **CODE_ERROR_001**: 代码语法错误
- **CODE_ERROR_002**: 运行时错误
- **FILE_ERROR_001**: 文件保存失败

### 技术支持
如需更多帮助，请联系：
- 官方网站：www.shensi.com
- 技术支持邮箱：support@shensi.com
- 用户社区：forum.shensi.com

